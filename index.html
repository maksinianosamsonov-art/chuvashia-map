<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Oksana's Story - Visual Novel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyanimated-fade-in {
            animation: fadeIn 0.4s ease-out forwards;
        }
        .scene-content {
            height: calc(100vh - 180px);
        }
        .choice-btn {
            transition: all 0.2s ease;
        }
        .choice-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        .choice-btn:active {
            transform: translateY(0);
        }
        .bg-theme {
            background: linear-gradient(135deg, #f0f9ff 0%, #e6f7ff 100%);
        }
        .text-theme {
            color: #1e40af;
        }
        .btn-theme {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
        }
        .btn-romance {
            background: linear-gradient(135deg, #ec4899 0%, #be185d 100%);
        }
        .btn-detective {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
        }
        .btn-mystery {
            background: linear-gradient(135deg, #0d9488 0%, #0f766e 100%);
        }
        .character-portrait {
            width: 120px;
            height: 180px;
            object-fit: cover;
            border-radius: 12px;
            border: 3px solid white;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        }
        .scene-text {
            line-height: 1.6;
            font-size: 1.1rem;
        }
        .back-button {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
    </style>
</head>
<body class="font-sans bg-theme" x-data="visualNovel()">
    <div class="min-h-screen flex flex-col" :class="{'dark:bg-gray-900': theme === 'dark', 'bg-theme': theme === 'light'}">
        <!-- Header -->
        <header class="p-4 flex items-center justify-between" :class="{'bg-gray-800 text-white': theme === 'dark', 'bg-blue-50 text-theme': theme === 'light'}">
            <div class="flex items-center space-x-3">
                <div class="w-10 h-10 rounded-full bg-blue-500 flex items-center justify-center text-white font-bold">O</div>
                <h1 class="text-xl font-bold">Oksana's Story</h1>
            </div>
            <div class="text-sm" x-show="currentScene !== 'menu'">
                <button @click="goBack" class="back-button px-3 py-1.5 rounded-lg font-medium">← Back</button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex-1 flex flex-col overflow-hidden">
            <!-- Main Menu -->
            <div x-show="currentScene === 'menu'" class="flex-1 flex flex-col items-center justify-center p-6 animated-fade-in">
                <div class="text-center mb-10">
                    <h2 class="text-3xl font-bold mb-4 text-theme">Choose Your Adventure</h2>
                    <p class="text-lg text-gray-600 max-w-md">Oksana's story has many paths. What will you choose?</p>
                </div>
                
                <div class="grid grid-cols-1 gap-4 w-full max-w-md">
                    <button @click="startStory('romance')" class="choice-btn btn-romance text-white py-4 px-6 rounded-xl font-semibold text-lg shadow-lg">
                        Romance Path
                    </button>
                    <button @click="startStory('detective')" class="choice-btn btn-detective text-white py-4 px-6 rounded-xl font-semibold text-lg shadow-lg">
                        Detective Path
                    </button>
                    <button @click="startStory('mystery')" class="choice-btn btn-mystery text-white py-4 px-6 rounded-xl font-semibold text-lg shadow-lg">
                        Mystery Path
                    </button>
                </div>
            </div>

            <!-- Story Scenes -->
            <div x-show="currentScene !== 'menu'" class="flex-1 flex flex-col p-4 animated-fade-in">
                <!-- Character Portrait -->
                <div class="flex justify-center mb-6">
                    <img :src="currentStoryData.portrait" :alt="currentStoryData.character" class="character-portrait">
                </div>
                
                <!-- Scene Content -->
                <div class="scene-content flex flex-col justify-between">
                    <div class="scene-text mb-6" :class="{'text-white': theme === 'dark', 'text-gray-800': theme === 'light'}" x-html="currentStoryData.text"></div>
                    
                    <!-- Choices -->
                    <div class="space-y-3">
                        <template x-for="(choice, index) in currentStoryData.choices" :key="index">
                            <button 
                                @click="makeChoice(index)" 
                                class="choice-btn w-full py-3.5 px-4 rounded-xl font-medium text-white shadow-md"
                                :class="getButtonClass(currentStoryType)"
                            >
                                <span x-text="choice.text"></span>
                            </button>
                        </template>
                    </div>
                </div>
            </div>

            <!-- Ending Screen -->
            <div x-show="isEnding" class="flex-1 flex flex-col items-center justify-center p-6 animated-fade-in">
                <div class="text-center max-w-md">
                    <h2 class="text-2xl font-bold mb-4 text-theme">The End</h2>
                    <p class="scene-text mb-8" x-text="endingText"></p>
                    <button @click="resetGame" class="choice-btn btn-theme text-white py-3 px-6 rounded-xl font-semibold shadow-lg">
                        Play Again
                    </button>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="p-3 text-center text-sm" :class="{'text-gray-400': theme === 'dark', 'text-gray-500': theme === 'light'}">
            Oksana's Visual Novel • Made with ❤️ for Telegram
        </footer>
    </div>

    <script>
        function visualNovel() {
            return {
                // Game state
                currentScene: 'menu',
                currentStoryType: '',
                storyProgress: {},
                isEnding: false,
                endingText: '',
                theme: 'light',

                // Initialize game
                init() {
                    // Initialize Telegram WebApp
                    if (window.Telegram && window.Telegram.WebApp) {
                        const tg = Telegram.WebApp;
                        tg.ready();
                        tg.expand();
                        tg.MainButton.hide();
                        
                        // Set theme based on Telegram
                        this.theme = tg.colorScheme;
                        
                        // Handle back button
                        tg.BackButton.onClick(() => {
                            this.goBack();
                        });
                    }
                    
                    // Load saved progress
                    this.loadProgress();
                },

                // Load progress from localStorage
                loadProgress() {
                    try {
                        const saved = localStorage.getItem('oksanaStoryProgress');
                        if (saved) {
                            this.storyProgress = JSON.parse(saved);
                        }
                    } catch (e) {
                        console.warn('Failed to load progress:', e);
                    }
                },

                // Save progress to localStorage
                saveProgress() {
                    try {
                        localStorage.setItem('oksanaStoryProgress', JSON.stringify(this.storyProgress));
                    } catch (e) {
                        console.warn('Failed to save progress:', e);
                    }
                },

                // Get button class based on story type
                getButtonClass(storyType) {
                    switch(storyType) {
                        case 'romance': return 'btn-romance';
                        case 'detective': return 'btn-detective';
                        case 'mystery': return 'btn-mystery';
                        default: return 'btn-theme';
                    }
                },

                // Start a new story
                startStory(storyType) {
                    this.currentStoryType = storyType;
                    this.currentScene = '1';
                    this.storyProgress[storyType] = { scene: '1', choices: [] };
                    this.saveProgress();
                    
                    // Show Telegram back button
                    if (window.Telegram && window.Telegram.WebApp) {
                        Telegram.WebApp.BackButton.show();
                    }
                },

                // Handle choice selection
                makeChoice(choiceIndex) {
                    const currentData = this.getSceneData(this.currentScene);
                    const choice = currentData.choices[choiceIndex];
                    
                    // Save choice
                    this.storyProgress[this.currentStoryType].choices.push({
                        scene: this.currentScene,
                        choice: choiceIndex
                    });
                    
                    // Handle ending
                    if (choice.ending) {
                        this.isEnding = true;
                        this.endingText = choice.endingText;
                        this.saveProgress();
                        
                        // Hide back button on ending
                        if (window.Telegram && window.Telegram.WebApp) {
                            Telegram.WebApp.BackButton.hide();
                        }
                        return;
                    }
                    
                    // Move to next scene
                    this.currentScene = choice.nextScene;
                    this.storyProgress[this.currentStoryType].scene = this.currentScene;
                    this.saveProgress();
                },

                // Go back to previous scene
                goBack() {
                    if (this.currentScene === '1') {
                        this.currentScene = 'menu';
                        this.currentStoryType = '';
                        if (window.Telegram && window.Telegram.WebApp) {
                            Telegram.WebApp.BackButton.hide();
                        }
                        return;
                    }
                    
                    // In a real implementation, you'd track the path and go back
                    // For simplicity, we'll just go to the menu
                    this.currentScene = 'menu';
                    this.currentStoryType = '';
                    if (window.Telegram && window.Telegram.WebApp) {
                        Telegram.WebApp.BackButton.hide();
                    }
                },

                // Reset game
                resetGame() {
                    this.currentScene = 'menu';
                    this.currentStoryType = '';
                    this.isEnding = false;
                    this.endingText = '';
                    this.storyProgress = {};
                    localStorage.removeItem('oksanaStoryProgress');
                    
                    if (window.Telegram && window.Telegram.WebApp) {
                        Telegram.WebApp.BackButton.hide();
                    }
                },

                // Get current story data
                get currentStoryData() {
                    return this.getSceneData(this.currentScene);
                },

                // Get scene data based on current story type and scene
                getSceneData(sceneId) {
                    const stories = {
                        romance: {
                            '1': {
                                character: 'Oksana',
                                portrait: 'https://placehold.co/600x900/ff6b9d/ffffff?text=Oksana+Romance',
                                text: "It's a beautiful spring afternoon in our small town. I'm walking through the park with my camera, hoping to capture the perfect shot of cherry blossoms. Suddenly, I notice someone familiar sitting on a bench...",
                                choices: [
                                    { text: "Approach him - it's Alex, my childhood friend", nextScene: '2' },
                                    { text: "Keep walking - I don't want to disturb him", nextScene: '3' }
                                ]
                            },
                            '2': {
                                character: 'Oksana',
                                portrait: 'https://placehold.co/600x900/ff6b9d/ffffff?text=Oksana+Romance',
                                text: '"Oksana! Fancy meeting you here!' Alex says with a warm smile. He's holding a sketchbook. 'I've been drawing the cherry blossoms. Would you like to see?'",
                                choices: [
                                    { text: "Yes, show me your sketches", nextScene: '4' },
                                    { text: "Actually, I was hoping to take some photos with you", ending: true, endingText: "Alex blushes and agrees. You spend the afternoon together, and this marks the beginning of a beautiful romance. Sometimes, taking a chance leads to the perfect shot - and the perfect relationship." }
                                ]
                            },
                            '3': {
                                character: 'Oksana',
                                portrait: 'https://placehold.co/600x900/ff6b9d/ffffff?text=Oksana+Romance',
                                text: "I keep walking, but I can't stop thinking about Alex. Maybe I should have said hello. As I turn back, I see him packing up his things...",
                                choices: [
                                    { text: "Run back and catch him before he leaves", nextScene: '5' },
                                    { text: "Continue walking - some moments are better left as memories", ending: true, endingText: "You capture a beautiful photo of the cherry blossoms, but it feels empty without Alex in it. Sometimes the perfect shot requires courage you didn't know you had." }
                                ]
                            },
                            '4': {
                                character: 'Oksana',
                                portrait: 'https://placehold.co/600x900/ff6b9d/ffffff?text=Oksana+Romance',
                                text: "His sketches are incredible! 'You've always been talented,' I say. Alex looks up and our eyes meet. There's a comfortable silence between us.",
                                choices: [
                                    { text: "Ask him if he wants to go for coffee", ending: true, endingText: "Alex agrees enthusiastically. Over coffee, you discover he's been taking photography classes too. Your shared passion blossoms into something more, and you both help each other grow as artists." },
                                    { text: "Thank him and leave - I need to finish my photo session", ending: true, endingText: "You say goodbye and continue your photography. Later, you find a small sketch of you tucked in your camera bag. Alex must have slipped it in when you weren't looking. A bittersweet reminder of what could have been." }
                                ]
                            },
                            '5': {
                                character: 'Oksana',
                                portrait: 'https://placehold.co/600x900/ff6b9d/ffffff?text=Oksana+Romance',
                                text: "I catch up to Alex just as he's about to leave. 'Wait!' I call out. He turns around, surprised but happy to see me.",
                                choices: [
                                    { text: "Invite him to help me with my photography project", ending: true, endingText: "Alex agrees, and you spend the next few weeks collaborating on a photography project about your hometown. Through this creative partnership, your friendship deepens into something more meaningful." },
                                    { text: "Apologize for not saying hello earlier", ending: true, endingText: "Alex smiles and says he was hoping you'd come back. You have an honest conversation about how life has kept you both busy, and you promise to stay in touch. Sometimes second chances are even sweeter than first ones." }
                                ]
                            }
                        },
                        detective: {
                            '1': {
                                character: 'Oksana',
                                portrait: 'https://placehold.co/600x900/8b5cf6/ffffff?text=Oksana+Detective',
                                text: "Something strange is happening in our town. Photos from the annual festival have gone missing from the community center, including some of my best shots. The police aren't taking it seriously, but I know these photos matter to people.",
                                choices: [
                                    { text: "Investigate the community center myself", nextScene: '2' },
                                    { text: "Ask my friend Mark, who works at the newspaper, for help", nextScene: '3' }
                                ]
                            },
                            '2': {
                                character: 'Oksana',
                                portrait: 'https://placehold.co/600x900/8b5cf6/ffffff?text=Oksana+Detective',
                                text: "I sneak into the community center after hours. The place is eerily quiet. In the darkroom, I notice something glinting under the developing table...",
                                choices: [
                                    { text: "Pick up the glinting object - it might be a clue", nextScene: '4' },
                                    { text: "Leave immediately - this feels dangerous", ending: true, endingText: "You decide it's too risky and leave. The photos are never recovered, but you learn an important lesson about knowing your limits. Sometimes the truth isn't worth the danger." }
                                ]
                            },
                            '3': {
                                character: 'Oksana',
                                portrait: 'https://placehold.co/600x900/8b5cf6/ffffff?text=Oksana+Detective',
                                text: "Mark agrees to help. 'I've heard rumors about a disgruntled former employee,' he says. 'Let's dig deeper.' We start by interviewing people who were at the festival.",
                                choices: [
                                    { text: "Focus on the festival organizers", nextScene: '5' },
                                    { text: "Talk to vendors who had booths at the event", nextScene: '6' }
                                ]
                            },
                            '4': {
                                character: 'Oksana',
                                portrait: 'https://placehold.co/600x900/8b5cf6/ffffff?text=Oksana+Detective',
                                text: "It's a small key with a unique symbol. This doesn't belong to the community center. Suddenly, I hear footsteps approaching!",
                                choices: [
                                    { text: "Hide and see who's coming", ending: true, endingText: "You hide and discover the mayor's assistant stealing evidence. With the key as proof, you expose a corruption scandal that rocks the town. Your photography skills help document everything, making you a local hero." },
                                    { text: "Confront the person immediately", ending: true, endingText: "You confront the intruder and recognize Mrs. Peterson, the community center director! She explains she took the photos to protect someone. Your investigation reveals a touching story of sacrifice, and the photos are returned with everyone's gratitude." }
                                ]
                            },
                            '5': {
                                character: 'Oksana',
                                portrait: 'https://placehold.co/600x900/8b5cf6/ffffff?text=Oksana+Detective',
                                text: "The organizers are defensive. 'Everything was secure,' they insist. But one organizer, Sarah, seems nervous. She keeps glancing at her watch.",
                                choices: [
                                    { text: "Ask Sarah directly about her behavior", ending: true, endingText: "Sarah breaks down and confesses. She took the photos because her brother was in them, and he's in witness protection. Your understanding and discretion help resolve the situation without exposing anyone to danger." },
                                    { text: "Check the security footage from that night", ending: true, endingText: "The footage shows someone tampering with the lock. You recognize the janitor, who admits he was paid to create a distraction. Following this lead, you uncover an elaborate insurance fraud scheme. Your detective work saves the community center from financial ruin." }
                                ]
                            },
                            '6': {
                                character: 'Oksana',
                                portrait: 'https://placehold.co/600x900/8b5cf6/ffffff?text=Oksana+Detective',
                                text: "The vendors remember a suspicious person near the photo display. 'Wore a hoodie, kept to the shadows,' says the ice cream vendor. Mark and I decide to stake out the area tonight.",
                                choices: [
                                    { text: "Set up hidden cameras to catch the thief", ending: true, endingText: "Your plan works! The cameras capture the thief red-handed. It's the new art teacher who wanted to steal students' work for a personal exhibition. Your evidence leads to their arrest and the photos' safe return." },
                                    { text: "Confront the thief directly when they appear", ending: true, endingText: "You catch the thief, but they're just a teenager trying to impress someone. Instead of calling the police, you help them understand the value of art and community. They return the photos and volunteer to help restore damaged ones. Sometimes justice means giving someone a second chance." }
                                ]
                            }
                        },
                        mystery: {
                            '1': {
                                character: 'Oksana',
                                portrait: 'https://placehold.co/600x900/0d9488/ffffff?text=Oksana+Mystery',
                                text: "Late at night, I'm developing photos from the old cemetery when I notice something impossible. In every photo, there's a shadowy figure that wasn't there when I took the pictures. My hands tremble as I examine the negatives...",
                                choices: [
                                    { text: "Return to the cemetery to investigate", nextScene: '2' },
                                    { text: "Show the photos to Professor Ivanov, the history teacher", nextScene: '3' }
                                ]
                            },
                            '2': {
                                character: 'Oksana',
                                portrait: 'https://placehold.co/600x900/0d9488/ffffff?text=Oksana+Mystery',
                                text: "The cemetery is shrouded in mist. I feel watched. Suddenly, my camera starts taking pictures by itself! The display shows a date: October 17, 1923.",
                                choices: [
                                    { text: "Follow the camera's direction - it seems to be leading somewhere", nextScene: '4' },
                                    { text: "Run away - this is too terrifying", ending: true, endingText: "You flee the cemetery and never develop those photos again. But sometimes, in your dreams, you see the shadowy figure, and you wonder what secrets you left buried in the past." }
                                ]
                            },
                            '3': {
                                character: 'Oksana',
                                portrait: 'https://placehold.co/600x900/0d9488/ffffff?text=Oksana+Mystery',
                                text: "Professor Ivanov's eyes widen. 'October 17, 1923... that's the night the old library burned down. Many lives were lost.' He shows me an old journal with a symbol matching the one in my photos.",
                                choices: [
                                    { text: "Search for the library's foundation in the town square", nextScene: '5' },
                                    { text: "Visit the town's historical society for more information", nextScene: '6' }
                                ]
                            },
                            '4': {
                                character: 'Oksana',
                                portrait: 'https://placehold.co/600x900/0d9488/ffffff?text=Oksana+Mystery',
                                text: "My camera leads me to a weathered gravestone with the same symbol. The inscription is worn, but I can make out 'Eliza'. As I touch the stone, visions flood my mind...",
                                choices: [
                                    { text: "Embrace the visions and see what they reveal", ending: true, endingText: "You learn Eliza was a photographer like you, who died in the library fire trying to save her work. Your connection helps her spirit find peace, and in return, she gifts you with extraordinary photographic intuition. Your photos now capture not just moments, but souls." },
                                    { text: "Break the connection and leave the cemetery", ending: true, endingText: "You break the connection and leave, but the experience changes you. Your photography takes on a new depth, capturing emotions and stories you never noticed before. Sometimes the greatest mysteries are the ones that transform us from within." }
                                ]
                            },
                            '5': {
                                character: 'Oksana',
                                portrait: 'https://placehold.co/600x900/0d9488/ffffff?text=Oksana+Mystery',
                                text: "Beneath the town square, I find hidden cellar doors. Inside, preserved perfectly, is Eliza's lost photography studio from 1923. Her camera sits on a table, still loaded with film.",
                                choices: [
                                    { text: "Use Eliza's camera to take a photo", ending: true, endingText: "Through the lens of Eliza's camera, you see the world as she did. The photo you take bridges past and present, revealing that Eliza's spirit has been guiding you to preserve the town's history through your art. Your photography becomes a legacy that spans generations." },
                                    { text: "Carefully document the studio and contact the historical society", ending: true, endingText: "Your discovery becomes a major historical find. The studio is preserved as a museum, and Eliza's work is finally recognized. Your photos of the discovery win national acclaim, proving that sometimes the past holds the key to our future success." }
                                ]
                            },
                            '6': {
                                character: 'Oksana',
                                portrait: 'https://placehold.co/600x900/0d9488/ffffff?text=Oksana+Mystery',
                                text: "The historical society has records of Eliza, a talented photographer who perished in the library fire. They mention she was working on a series about 'time echoes' - moments that repeat across generations.",
                                choices: [
                                    { text: "Recreate Eliza's last known photo locations", ending: true, endingText: "By standing where Eliza stood, you capture the same scenes 100 years later. Your photo series 'Echoes of Time' becomes a sensation, showing how the town has changed while revealing uncanny parallels between past and present. Your work helps the community connect with its roots." },
                                    { text: "Use your photos to create a memorial exhibition for Eliza", ending: true, endingText: "Your exhibition honors Eliza's memory and showcases your own work alongside her recovered photos. The emotional response from the town is overwhelming. You realize your photography has the power to heal historical wounds and bring communities together across time." }
                                ]
                            }
                        }
                    };
                    
                    return stories[this.currentStoryType][sceneId] || {
                        character: 'Oksana',
                        portrait: 'https://placehold.co/600x900/3b82f6/ffffff?text=Oksana',
                        text: "An unexpected turn in the story...",
                        choices: [{ text: "Return to menu", nextScene: 'menu' }]
                    };
                }
            };
        }
    </script>
</body>
</html>

