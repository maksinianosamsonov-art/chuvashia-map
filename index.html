<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Чувашия — Dark Mode</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    /* Настраиваем тёмный фон страницы, чтобы он сливался с маской */
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      background: #222222; /* Тёмно-серый фон */
      overflow: hidden;
    }
    #map {
      height: 100%;
      width: 100%;
      background: #222222;
    }
    /* Делаем контейнер карты тёмным */
    .leaflet-container {
      background: #222222 !important;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
    // === 1. Инициализация Telegram ===
    const tg = window.Telegram?.WebApp;
    if (tg) {
      tg.ready();
      tg.expand();
      tg.disableVerticalSwipes();
      // Устанавливаем тёмный цвет хедера в Telegram
      tg.setHeaderColor('#222222'); 
      tg.setBackgroundColor('#222222');
    }

    // === 2. Координаты границы Чувашии (упрощённые для Web) ===
    // Это массив точек, образующий контур республики
    const chuvashiaCoords = [
      [55.998,47.228],[56.021,47.310],[56.033,47.412],[56.040,47.520],[56.038,47.630],[56.025,47.720],[56.000,47.810],[55.965,47.890],[55.920,47.950],[55.870,48.010],[55.810,48.060],[55.750,48.100],[55.680,48.130],[55.610,48.150],[55.540,48.160],[55.470,48.165],[55.400,48.160],[55.330,48.145],[55.260,48.120],[55.190,48.090],[55.120,48.050],[55.050,48.000],[54.980,47.940],[54.920,47.870],[54.860,47.790],[54.810,47.700],[54.760,47.600],[54.720,47.500],[54.690,47.390],[54.670,47.280],[54.660,47.170],[54.660,47.060],[54.670,46.950],[54.690,46.840],[54.720,46.740],[54.760,46.640],[54.810,46.550],[54.860,46.470],[54.920,46.400],[54.980,46.340],[55.050,46.290],[55.120,46.250],[55.190,46.220],[55.260,46.200],[55.330,46.190],[55.400,46.190],[55.470,46.200],[55.540,46.220],[55.610,46.250],[55.680,46.290],[55.750,46.340],[55.810,46.400],[55.870,46.470],[55.920,46.550],[55.965,46.640],[56.000,46.740],[56.025,46.840],[56.038,46.950],[56.040,47.060],[56.033,47.170],[55.998,47.228]
    ];

    try {
      // === 3. Создаём карту ===
      const map = L.map('map', {
        minZoom: 8,
        maxZoom: 16,
        zoomControl: false, // Скрываем кнопки зума для чистоты (можно включить: true)
        attributionControl: false // Скрываем копирайт (для красоты, но лучше оставить маленьким)
      });

      // === 4. Тёмные тайлы (CartoDB Dark Matter) ===
      // Идеально подходят: чёрная вода, тёмно-серая суша, белые надписи
      L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
        maxZoom: 19
      }).addTo(map);

      // === 5. Создаём "Маску" (Вырез) ===
      // Мы создаём гигантский полигон (весь мир), а внутри него "дырку" (Чувашия).
      // Цвет маски совпадает с фоном body (#222222), поэтому кажется, что карты за пределами нет.
      
      const worldWithHole = [
        [ // Внешний контур (весь мир)
          [90, -180], [90, 180], [-90, 180], [-90, -180]
        ],
        chuvashiaCoords // Внутренний контур ("дырка" - Чувашия)
      ];

      L.polygon(worldWithHole, {
        color: 'transparent', // Линии маски не рисуем
        fillColor: '#222222', // ЦВЕТ ФОНА ЗА ПРЕДЕЛАМИ (Серый)
        fillOpacity: 1,       // Полностью непрозрачный
        interactive: false    // Чтобы клики сквозь маску не проходили (опционально)
      }).addTo(map);


      // === 6. Рисуем ЧЁТКУЮ ЧЁРНУЮ ГРАНИЦУ ===
      // Это отдельный слой, который рисует линию поверх маски
      L.polygon(chuvashiaCoords, {
        color: '#000000', // Чистый чёрный цвет
        weight: 4,        // Толщина линии (можно сделать 5 или 3)
        fillColor: 'transparent', // Внутри ничего не закрашиваем (там карта)
        fillOpacity: 0
      }).addTo(map);


      // === 7. Центрируем карту ===
      const bounds = L.polygon(chuvashiaCoords).getBounds();
      map.fitBounds(bounds, { padding: [20, 20] });

      // Ограничиваем просмотр
      map.setMaxBounds(bounds.pad(0.5)); 


      // === 8. Добавляем маркер (Пример) ===
      // Батырево
      L.circleMarker([55.373, 47.333], {
        radius: 6,
        fillColor: "#ffffff",
        color: "#000",
        weight: 1,
        opacity: 1,
        fillOpacity: 0.8
      }).addTo(map).bindPopup("Батырево");

    } catch (e) {
      console.error(e);
      document.body.innerHTML = "<h3 style='color:white;text-align:center;margin-top:20px'>Ошибка карты</h3>";
    }
  </script>
</body>
</html>
