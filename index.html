<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ò—Å—Ç–æ—Ä–∏–∏ –û–∫—Å–∞–Ω—ã</title>
    
    <!-- Telegram Web App SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel (–¥–ª—è JSX –≤ –±—Ä–∞—É–∑–µ—Ä–µ) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;800&family=Lora:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">

    <style>
        /* –ë–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –∏ –∞–Ω–∏–º–∞—Ü–∏–∏ */
        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--tg-theme-bg-color, #1a202c);
            color: var(--tg-theme-text-color, #f7fafc);
            overflow: hidden; /* –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º —Å–∫—Ä–æ–ª–ª –≤—Å–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
            touch-action: manipulation;
        }

        /* –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è –Ω–æ–≤–µ–ª–ª—ã */
        .novel-text {
            font-family: 'Lora', serif;
        }

        .fade-enter {
            opacity: 0;
            transform: translateY(10px);
        }
        .fade-enter-active {
            opacity: 1;
            transform: translateY(0);
            transition: opacity 500ms, transform 500ms;
        }
        .fade-exit {
            opacity: 1;
        }
        .fade-exit-active {
            opacity: 0;
            transition: opacity 300ms;
        }

        /* –≠—Ñ—Ñ–µ–∫—Ç —Å—Ç–µ–∫–ª–∞ */
        .glass-panel {
            background: rgba(var(--tg-theme-bg-color-rgb, 30, 41, 59), 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 -4px 20px rgba(0,0,0,0.2);
        }

        /* –°–∫—Ä—ã–≤–∞–µ–º —Å–∫—Ä–æ–ª–ª–±–∞—Ä */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–µ—á–∞—Ç–∏ */
        .typing-cursor::after {
            content: '|';
            animation: blink 1s step-start infinite;
        }
        @keyframes blink { 50% { opacity: 0; } }
        
        /* –ö–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–æ–≤ */
        .choice-btn {
            background-color: var(--tg-theme-button-color, #3b82f6);
            color: var(--tg-theme-button-text-color, #ffffff);
            transition: all 0.2s;
        }
        .choice-btn:active {
            transform: scale(0.98);
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // --- –î–ê–ù–ù–´–ï –°–Æ–ñ–ï–¢–ê ---
        const STORIES = {
            intro: {
                id: 'intro',
                text: "–ü—Ä–∏–≤–µ—Ç! –ú–µ–Ω—è –∑–æ–≤—É—Ç –û–∫—Å–∞–Ω–∞. –ú–Ω–µ 18, —è —É—á—É—Å—å –Ω–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∞ –∏ –∂–∏–≤—É –≤ —ç—Ç–æ–º, –∫–∞–∑–∞–ª–æ—Å—å –±—ã, –æ–±—ã—á–Ω–æ–º –≥–æ—Ä–æ–¥–µ.",
                background: "https://images.unsplash.com/photo-1516483638261-f4dbaf036963?q=80&w=1286&auto=format&fit=crop",
                speaker: "–û–∫—Å–∞–Ω–∞",
                emotion: "smile",
                choices: [
                    { text: "–†–∞—Å—Å–∫–∞–∑–∞—Ç—å –æ —Å–µ–±–µ", next: "intro_2" }
                ]
            },
            intro_2: {
                id: 'intro_2',
                text: "–°–µ–≥–æ–¥–Ω—è –æ—Å–æ–±–µ–Ω–Ω—ã–π –¥–µ–Ω—å. –£ –º–µ–Ω—è –≤—ã—Ö–æ–¥–Ω–æ–π, –∏ —è –º–æ–≥—É –ø–æ–π—Ç–∏ –∫—É–¥–∞ —É–≥–æ–¥–Ω–æ. –ß—Ç–æ –≤—ã–±–µ—Ä–µ–º?",
                background: "https://images.unsplash.com/photo-1516483638261-f4dbaf036963?q=80&w=1286&auto=format&fit=crop",
                speaker: "–û–∫—Å–∞–Ω–∞",
                choices: [
                    { text: "–ü–æ–π—Ç–∏ –≤ –ø–∞—Ä–∫ (–†–æ–º–∞–Ω—Ç–∏–∫–∞) üíñ", next: "romance_start", type: "romance" },
                    { text: "–ù–∞–π—Ç–∏ —Å—Ç–∞—Ä—É—é –∫–∞–º–µ—Ä—É (–î–µ—Ç–µ–∫—Ç–∏–≤) üîç", next: "detective_start", type: "detective" },
                    { text: "–ó–∞–π—Ç–∏ –≤ –∞–Ω—Ç–∏–∫–≤–∞—Ä–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω (–ú–∏—Å—Ç–∏–∫–∞) üîÆ", next: "mystic_start", type: "mystic" }
                ]
            },

            // --- –í–µ—Ç–∫–∞ –†–û–ú–ê–ù–¢–ò–ö–ê ---
            romance_start: {
                id: 'romance_start',
                text: "–ü–∞—Ä–∫ —Å–µ–≥–æ–¥–Ω—è –≤–µ–ª–∏–∫–æ–ª–µ–ø–µ–Ω. –°–æ–ª–Ω—Ü–µ –ø—Ä–æ–±–∏–≤–∞–µ—Ç—Å—è —Å–∫–≤–æ–∑—å –ª–∏—Å—Ç–≤—É... –û–π!",
                background: "https://images.unsplash.com/photo-1519331379826-f9491da3fa6a?q=80&w=1287&auto=format&fit=crop",
                speaker: "–û–∫—Å–∞–Ω–∞",
                effect: "shake",
                choices: [
                    { text: "–ß—Ç–æ —Å–ª—É—á–∏–ª–æ—Å—å?", next: "romance_collision" }
                ]
            },
            romance_collision: {
                id: 'romance_collision',
                text: "–î–µ–≤—É—à–∫–∞, –ø—Ä–æ—Å—Ç–∏—Ç–µ! –Ø –∑–∞—Å–º–æ—Ç—Ä–µ–ª—Å—è –Ω–∞ –∫–∞—Ä—Ç—É. –í—ã –Ω–µ —É—à–∏–±–ª–∏—Å—å? ‚Äî –ü–µ—Ä–µ–¥–æ –º–Ω–æ–π —Å—Ç–æ–∏—Ç –ø–∞—Ä–µ–Ω—å —Å –¥–æ–±—Ä—ã–º–∏ –≥–ª–∞–∑–∞–º–∏.",
                background: "https://images.unsplash.com/photo-1519331379826-f9491da3fa6a?q=80&w=1287&auto=format&fit=crop",
                speaker: "–ù–µ–∑–Ω–∞–∫–æ–º–µ—Ü",
                characterImg: "https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?q=80&w=200&auto=format&fit=crop",
                choices: [
                    { text: "–í—Å—ë –≤ –ø–æ—Ä—è–¥–∫–µ, —è –û–∫—Å–∞–Ω–∞.", next: "romance_meet_good" },
                    { text: "–°–º–æ—Ç—Ä–µ—Ç—å –Ω–∞–¥–æ, –∫—É–¥–∞ –∏–¥–µ—à—å.", next: "romance_meet_bad" }
                ]
            },
            romance_meet_good: {
                id: 'romance_meet_good',
                text: "–û–∫—Å–∞–Ω–∞... –ö—Ä–∞—Å–∏–≤–æ–µ –∏–º—è. –ê —è –ê—Ä—Ç—ë–º. –Ø —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ, –∏—â—É –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ. –ù–µ —Ö–æ—Ç–∏—Ç–µ —Å–æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–ø–∞–Ω–∏—é?",
                background: "https://images.unsplash.com/photo-1519331379826-f9491da3fa6a?q=80&w=1287&auto=format&fit=crop",
                speaker: "–ê—Ä—Ç—ë–º",
                characterImg: "https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?q=80&w=200&auto=format&fit=crop",
                choices: [
                    { text: "–° —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ–º!", next: "romance_end_happy" },
                    { text: "–Ø —Å–ø–µ—à—É, –∏–∑–≤–∏–Ω–∏.", next: "romance_end_neutral" }
                ]
            },
             romance_meet_bad: {
                id: 'romance_meet_bad',
                text: "–ü–æ–Ω—è–ª, –Ω–µ –±—É–¥—É –º–µ—à–∞—Ç—å. –•–æ—Ä–æ—à–µ–≥–æ –¥–Ω—è. ‚Äî –û–Ω –≥—Ä—É—Å—Ç–Ω–æ —É–ª—ã–±–Ω—É–ª—Å—è –∏ —É—à–µ–ª.",
                background: "https://images.unsplash.com/photo-1519331379826-f9491da3fa6a?q=80&w=1287&auto=format&fit=crop",
                speaker: "–ê—Ä—Ç—ë–º",
                choices: [
                    { text: "–≠—Ö, –∑—Ä—è —è —Ç–∞–∫...", next: "intro_2" }
                ]
            },
             romance_end_happy: {
                id: 'romance_end_happy',
                text: "–ö–æ–Ω–µ—Ü –¥–µ–º–æ-–≤–µ—Ä—Å–∏–∏ (–†–æ–º–∞–Ω—Ç–∏–∫–∞): –í—ã –ø–æ—à–ª–∏ –≥—É–ª—è—Ç—å –∏ —Å–¥–µ–ª–∞–ª–∏ –æ—Ç–ª–∏—á–Ω—ã–µ –∫–∞–¥—Ä—ã –≤–º–µ—Å—Ç–µ!",
                background: "https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?q=80&w=1287&auto=format&fit=crop",
                speaker: "–°–∏—Å—Ç–µ–º–∞",
                isEnd: true,
                choices: [{ text: "–í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", next: "intro" }]
            },
            romance_end_neutral: {
                id: 'romance_end_neutral',
                text: "–ö–æ–Ω–µ—Ü –¥–µ–º–æ-–≤–µ—Ä—Å–∏–∏ (–†–æ–º–∞–Ω—Ç–∏–∫–∞): –í—ã —Ä–∞–∑–æ—à–ª–∏—Å—å, –Ω–æ, –≤–æ–∑–º–æ–∂–Ω–æ, –≤—Å—Ç—Ä–µ—Ç–∏—Ç–µ—Å—å —Å–Ω–æ–≤–∞.",
                background: "https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?q=80&w=1287&auto=format&fit=crop",
                speaker: "–°–∏—Å—Ç–µ–º–∞",
                isEnd: true,
                choices: [{ text: "–í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", next: "intro" }]
            },


            // --- –í–µ—Ç–∫–∞ –î–ï–¢–ï–ö–¢–ò–í ---
            detective_start: {
                id: 'detective_start',
                text: "–í –∫—É—Å—Ç–∞—Ö —á—Ç–æ-—Ç–æ –±–ª–µ—Å–Ω—É–ª–æ. –≠—Ç–æ —Å—Ç–∞—Ä—ã–π –ø–ª–µ–Ω–æ—á–Ω—ã–π —Ñ–æ—Ç–æ–∞–ø–ø–∞—Ä–∞—Ç '–ó–µ–Ω–∏—Ç'. –í–Ω—É—Ç—Ä–∏ –ø–ª–µ–Ω–∫–∞.",
                background: "https://images.unsplash.com/photo-1444703686981-a3abbc4d4fe3?q=80&w=1470&auto=format&fit=crop",
                speaker: "–û–∫—Å–∞–Ω–∞",
                choices: [
                    { text: "–ü—Ä–æ—è–≤–∏—Ç—å –ø–ª–µ–Ω–∫—É –¥–æ–º–∞", next: "detective_develop" },
                    { text: "–û—Ç–Ω–µ—Å—Ç–∏ –≤ –ø–æ–ª–∏—Ü–∏—é", next: "detective_police" }
                ]
            },
            detective_develop: {
                id: 'detective_develop',
                text: "–í –∫—Ä–∞—Å–Ω–æ–º —Å–≤–µ—Ç–µ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏–∏ –ø—Ä–æ—è–≤–ª—è—é—Ç—Å—è –∫–∞–¥—Ä—ã... –ë–æ–∂–µ –º–æ–π. –ù–∞ —Ñ–æ—Ç–æ –º–µ—Å—Ç–æ –ø—Ä–µ—Å—Ç—É–ø–ª–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä–æ–µ –ø—Ä–æ–∏–∑–æ—à–ª–æ –≤—á–µ—Ä–∞!",
                background: "https://images.unsplash.com/photo-1599666505327-77564d7c0764?q=80&w=1470&auto=format&fit=crop",
                speaker: "–û–∫—Å–∞–Ω–∞",
                effect: "flash",
                choices: [
                    { text: "–†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –¥–µ—Ç–∞–ª–∏", next: "detective_clue" }
                ]
            },
            detective_clue: {
                id: 'detective_clue',
                text: "–ù–∞ –∑–∞–¥–Ω–µ–º –ø–ª–∞–Ω–µ –≤–∏–¥–Ω–æ –ª–∏—Ü–æ —á–µ–ª–æ–≤–µ–∫–∞. –û–Ω –∫–∞–∂–µ—Ç—Å—è –º–Ω–µ –∑–Ω–∞–∫–æ–º—ã–º...",
                background: "https://images.unsplash.com/photo-1599666505327-77564d7c0764?q=80&w=1470&auto=format&fit=crop",
                speaker: "–û–∫—Å–∞–Ω–∞",
                choices: [
                    { text: "–ö–æ–Ω–µ—Ü –¥–µ–º–æ (–î–µ—Ç–µ–∫—Ç–∏–≤)", next: "intro" }
                ]
            },
            detective_police: {
                id: 'detective_police',
                text: "–ü–æ–ª–∏—Ü–µ–π—Å–∫–∏–π —Å–∫—É—á–∞—é—â–µ –ø—Ä–∏–Ω—è–ª –∫–∞–º–µ—Ä—É. '–ú—ã —Ä–∞–∑–±–µ—Ä–µ–º—Å—è', - —Å–∫–∞–∑–∞–ª –æ–Ω, –Ω–æ —è –≤–∏–¥–µ–ª–∞, –∫–∞–∫ –æ–Ω –±—Ä–æ—Å–∏–ª –µ—ë –≤ —è—â–∏–∫ –∑–∞–±—ã—Ç—ã—Ö –≤–µ—â–µ–π.",
                background: "https://images.unsplash.com/photo-1444703686981-a3abbc4d4fe3?q=80&w=1470&auto=format&fit=crop",
                speaker: "–û–∫—Å–∞–Ω–∞",
                isEnd: true,
                choices: [{ text: "–í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", next: "intro" }]
            },

            // --- –í–µ—Ç–∫–∞ –ú–ò–°–¢–ò–ö–ê ---
            mystic_start: {
                id: 'mystic_start',
                text: "–ê–Ω—Ç–∏–∫–≤–∞—Ä–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω –ø–∞—Ö–Ω–µ—Ç –ø—ã–ª—å—é –∏ –≤–æ—Å–∫–æ–º. –°—Ç–∞—Ä–æ–µ –∑–µ—Ä–∫–∞–ª–æ –≤ —É–≥–ª—É –ø—Ä–∏—Ç—è–≥–∏–≤–∞–µ—Ç –≤–∑–≥–ª—è–¥. –û—Ç—Ä–∞–∂–µ–Ω–∏–µ –≤ –Ω–µ–º... –¥–≤–∏–∂–µ—Ç—Å—è —Å–∞–º–æ –ø–æ —Å–µ–±–µ?",
                background: "https://images.unsplash.com/photo-1504194921103-f8b80cadd5e4?q=80&w=1470&auto=format&fit=crop",
                speaker: "–û–∫—Å–∞–Ω–∞",
                choices: [
                    { text: "–ü–æ–¥–æ–π—Ç–∏ –±–ª–∏–∂–µ", next: "mystic_touch" },
                    { text: "–£–±–µ–∂–∞—Ç—å", next: "mystic_run" }
                ]
            },
            mystic_touch: {
                id: 'mystic_touch',
                text: "–Ø –∫–æ—Å–Ω—É–ª–∞—Å—å —Å—Ç–µ–∫–ª–∞. –û–Ω–æ —Ö–æ–ª–æ–¥–Ω–æ–µ, –∫–∞–∫ –ª–µ–¥. –í–¥—Ä—É–≥ –º–æ—è —Ä—É–∫–∞ –ø—Ä–æ—à–ª–∞ —Å–∫–≤–æ–∑—å –Ω–µ–≥–æ! –ú–µ–Ω—è –∑–∞—Ç—è–≥–∏–≤–∞–µ—Ç!",
                background: "https://images.unsplash.com/photo-1518536836162-849557a55227?q=80&w=1335&auto=format&fit=crop",
                speaker: "–û–∫—Å–∞–Ω–∞",
                effect: "zoom",
                choices: [
                    { text: "–°–æ–ø—Ä–æ—Ç–∏–≤–ª—è—Ç—å—Å—è", next: "mystic_resist" },
                    { text: "–ü–æ–¥–¥–∞—Ç—å—Å—è", next: "mystic_accept" }
                ]
            },
            mystic_run: {
                id: 'mystic_run',
                text: "–Ø –≤—ã–±–µ–∂–∞–ª–∞ –Ω–∞ —É–ª–∏—Ü—É, –∂–∞–¥–Ω–æ —Ö–≤–∞—Ç–∞—è –≤–æ–∑–¥—É—Ö. –ù–µ—Ç, —Å –º–µ–Ω—è —Ö–≤–∞—Ç–∏—Ç –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–π –Ω–∞ —Å–µ–≥–æ–¥–Ω—è.",
                background: "https://images.unsplash.com/photo-1516483638261-f4dbaf036963?q=80&w=1286&auto=format&fit=crop",
                speaker: "–û–∫—Å–∞–Ω–∞",
                isEnd: true,
                choices: [{ text: "–í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", next: "intro" }]
            },
            mystic_accept: {
                id: 'mystic_accept',
                text: "–ö–æ–Ω–µ—Ü –¥–µ–º–æ (–ú–∏—Å—Ç–∏–∫–∞): –í—ã –ø–æ–ø–∞–ª–∏ –≤ –ó–∞–∑–µ—Ä–∫–∞–ª—å–µ.",
                background: "https://images.unsplash.com/photo-1518536836162-849557a55227?q=80&w=1335&auto=format&fit=crop",
                isEnd: true,
                choices: [{ text: "–í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", next: "intro" }]
            },
             mystic_resist: {
                id: 'mystic_resist',
                text: "–ö–æ–Ω–µ—Ü –¥–µ–º–æ (–ú–∏—Å—Ç–∏–∫–∞): –í–∞–º —É–¥–∞–ª–æ—Å—å –≤—ã—Ä–≤–∞—Ç—å—Å—è, –Ω–æ –∑–µ—Ä–∫–∞–ª–æ —Ç—Ä–µ—Å–Ω—É–ª–æ.",
                background: "https://images.unsplash.com/photo-1504194921103-f8b80cadd5e4?q=80&w=1470&auto=format&fit=crop",
                isEnd: true,
                choices: [{ text: "–í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", next: "intro" }]
            }
        };

        // --- –ö–û–ú–ü–û–ù–ï–ù–¢–´ ---

        // –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ (–§–æ—Ç–æ –∏–≥—Ä–æ–∫–∞)
        const OksanaAvatar = () => {
             // –ò—Å–ø–æ–ª—å–∑—É–µ–º uploaded file reference –µ—Å–ª–∏ –æ–Ω –±—ã–ª, –∏–Ω–∞—á–µ fallback
            const avatarSrc = "https://api.dicebear.com/9.x/avataaars/svg?seed=Oksana&eyebrows=defaultNatural&hair=longHair&hairColor=2c1b18&skinColor=f8d25c";
            
            return (
                <div className="w-24 h-24 rounded-full border-4 border-white/30 overflow-hidden shadow-lg bg-black relative">
                   <img 
                        src={avatarSrc} 
                        alt="Oksana" 
                        className="w-full h-full object-cover"
                    />
                </div>
            );
        };

        const MainMenu = ({ onStart, hasSave }) => {
            return (
                <div className="absolute inset-0 z-50 flex flex-col items-center justify-center bg-gray-900 text-white p-6">
                    <div className="absolute inset-0 opacity-40 bg-[url('https://images.unsplash.com/photo-1493612276216-ee3925520721?q=80&w=1364&auto=format&fit=crop')] bg-cover bg-center"></div>
                    <div className="z-10 text-center w-full max-w-md backdrop-blur-sm p-8 rounded-2xl border border-white/10 shadow-2xl bg-black/40">
                        <div className="mx-auto mb-6 w-32 h-32 rounded-full border-4 border-pink-500 shadow-[0_0_20px_rgba(236,72,153,0.5)] overflow-hidden">
                             <img 
                                src="https://api.dicebear.com/9.x/avataaars/svg?seed=Oksana&eyebrows=defaultNatural&hair=longHair&hairColor=2c1b18&skinColor=f8d25c" 
                                alt="Oksana" 
                                className="w-full h-full object-cover"
                            />
                        </div>
                        <h1 className="text-4xl font-bold mb-2 bg-clip-text text-transparent bg-gradient-to-r from-pink-400 to-purple-400">–û–∫—Å–∞–Ω–∞</h1>
                        <p className="text-gray-300 mb-8 font-serif italic">–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è</p>
                        
                        <div className="space-y-3 w-full">
                            {hasSave && (
                                <button 
                                    onClick={() => onStart(true)}
                                    className="w-full py-4 rounded-xl bg-gradient-to-r from-green-600 to-teal-600 font-bold text-lg shadow-lg active:scale-95 transition-transform"
                                >
                                    –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å
                                </button>
                            )}
                            <button 
                                onClick={() => onStart(false)}
                                className="w-full py-4 rounded-xl bg-gradient-to-r from-pink-600 to-purple-600 font-bold text-lg shadow-lg active:scale-95 transition-transform"
                            >
                                –ù–æ–≤–∞—è –∏–≥—Ä–∞
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        const Scene = ({ data, onChoice }) => {
            const [displayText, setDisplayText] = useState('');
            const [showChoices, setShowChoices] = useState(false);
            const tg = window.Telegram.WebApp;

            // –≠—Ñ—Ñ–µ–∫—Ç –ø–µ—á–∞—Ç–Ω–æ–π –º–∞—à–∏–Ω–∫–∏
            useEffect(() => {
                setDisplayText('');
                setShowChoices(false);
                let i = 0;
                const text = data.text;
                const speed = 25; // ms per char

                const timer = setInterval(() => {
                    if (i < text.length) {
                        setDisplayText(prev => prev + text.charAt(i));
                        i++;
                    } else {
                        clearInterval(timer);
                        setShowChoices(true);
                    }
                }, speed);

                return () => clearInterval(timer);
            }, [data]);

            const handleChoice = (nextId) => {
                if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('light');
                onChoice(nextId);
            };

            return (
                <div className="h-full flex flex-col relative">
                    {/* –§–æ–Ω */}
                    <div 
                        className={`absolute inset-0 bg-cover bg-center transition-all duration-700 ease-in-out ${data.effect === 'zoom' ? 'scale-110' : 'scale-100'}`}
                        style={{ backgroundImage: `url(${data.background})` }}
                    >
                        <div className="absolute inset-0 bg-gradient-to-t from-gray-900 via-transparent to-black/30"></div>
                    </div>

                    {/* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å (Header) - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ */}
                    <div className="relative z-10 p-4 flex justify-between items-start safe-area-top">
                        {/* –ö–Ω–æ–ø–∫–∏ –º–µ–Ω—é –∏–ª–∏ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è –º–æ–≥–ª–∏ –±—ã –±—ã—Ç—å –∑–¥–µ—Å—å */}
                    </div>

                    {/* –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è —á–∞—Å—Ç—å —Å –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–º (–µ—Å–ª–∏ –µ—Å—Ç—å —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫) */}
                    <div className="flex-1 relative z-10 flex items-end justify-center pb-64 pointer-events-none">
                         {data.characterImg && (
                             <div className={`transition-all duration-500 transform translate-y-0 opacity-100`}>
                                 <img 
                                    src={data.characterImg} 
                                    className="max-h-[50vh] drop-shadow-2xl" 
                                    alt="Character"
                                />
                             </div>
                         )}
                    </div>

                    {/* –¢–µ–∫—Å—Ç–æ–≤–∞—è –ø–∞–Ω–µ–ª—å (–≤–Ω–∏–∑—É) */}
                    <div className="absolute bottom-0 w-full z-20 glass-panel rounded-t-3xl pb-safe">
                        <div className="p-6">
                            {/* –ò–º—è —Å–ø–∏–∫–µ—Ä–∞ –∏ –∞–≤–∞—Ç–∞—Ä –û–∫—Å–∞–Ω—ã –µ—Å–ª–∏ —ç—Ç–æ –æ–Ω–∞ */}
                            <div className="flex items-center gap-3 mb-3 -mt-12">
                                {data.speaker === "–û–∫—Å–∞–Ω–∞" ? (
                                    <OksanaAvatar />
                                ) : (
                                    <div className="w-12 h-12 rounded-full bg-indigo-600 border-2 border-white flex items-center justify-center font-bold text-xl shadow-md">
                                        {data.speaker[0]}
                                    </div>
                                )}
                                <div className="bg-black/60 backdrop-blur-md px-4 py-1 rounded-full border border-white/20">
                                    <span className="text-pink-400 font-bold uppercase tracking-wide text-sm">
                                        {data.speaker}
                                    </span>
                                </div>
                            </div>

                            {/* –¢–µ–∫—Å—Ç */}
                            <div className="min-h-[80px] mb-4">
                                <p className="text-lg leading-relaxed novel-text text-gray-100">
                                    {displayText}
                                    {!showChoices && <span className="typing-cursor text-pink-500"></span>}
                                </p>
                            </div>

                            {/* –ö–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–æ–≤ */}
                            <div className={`space-y-3 transition-opacity duration-500 ${showChoices ? 'opacity-100' : 'opacity-0 pointer-events-none'}`}>
                                {data.choices.map((choice, idx) => (
                                    <button
                                        key={idx}
                                        onClick={() => handleChoice(choice.next)}
                                        className="choice-btn w-full py-3.5 px-5 rounded-xl font-semibold text-left flex justify-between items-center group shadow-md"
                                    >
                                        <span>{choice.text}</span>
                                        <span className="opacity-0 group-hover:opacity-100 transition-opacity">‚ûú</span>
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [gameState, setGameState] = useState('menu'); // menu, game
            const [currentSceneId, setCurrentSceneId] = useState('intro');
            const [history, setHistory] = useState([]); // –î–ª—è –∫–Ω–æ–ø–∫–∏ –ù–∞–∑–∞–¥
            const tg = window.Telegram.WebApp;

            useEffect(() => {
                tg.expand();
                tg.ready();
                
                // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ü–≤–µ—Ç–æ–≤ –ø–æ —Ç–µ–º–µ Telegram
                if (tg.themeParams) {
                    const root = document.documentElement;
                    root.style.setProperty('--tg-theme-bg-color', tg.themeParams.bg_color || '#1a202c');
                    root.style.setProperty('--tg-theme-text-color', tg.themeParams.text_color || '#f7fafc');
                    root.style.setProperty('--tg-theme-button-color', tg.themeParams.button_color || '#3b82f6');
                    root.style.setProperty('--tg-theme-button-text-color', tg.themeParams.button_text_color || '#ffffff');
                    
                    // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è HEX –≤ RGB –¥–ª—è —Å—Ç–µ–∫–ª—è–Ω–Ω–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∞
                    const hexToRgb = (hex) => {
                        const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
                        return result ? `${parseInt(result[1], 16)}, ${parseInt(result[2], 16)}, ${parseInt(result[3], 16)}` : null;
                    }
                    const bgRgb = hexToRgb(tg.themeParams.secondary_bg_color || '#1e293b');
                    if(bgRgb) root.style.setProperty('--tg-theme-bg-color-rgb', bgRgb);
                }

                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ –ù–∞–∑–∞–¥ (—Å–∏—Å—Ç–µ–º–Ω–æ–π)
                tg.BackButton.onClick(() => {
                     handleBack();
                });
            }, []);

            // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç—å—é –∫–Ω–æ–ø–∫–∏ –ù–∞–∑–∞–¥
            useEffect(() => {
                if (gameState === 'game' && history.length > 0) {
                    tg.BackButton.show();
                } else {
                    tg.BackButton.hide();
                }
            }, [gameState, history]);

            const handleStart = (continueGame) => {
                if (continueGame) {
                    const saved = localStorage.getItem('oksana_save');
                    if (saved) {
                        setCurrentSceneId(saved);
                        setGameState('game');
                        return;
                    }
                }
                setCurrentSceneId('intro');
                setHistory([]);
                setGameState('game');
            };

            const handleChoice = (nextId) => {
                setHistory(prev => [...prev, currentSceneId]);
                setCurrentSceneId(nextId);
                // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
                localStorage.setItem('oksana_save', nextId);
            };
            
            const handleBack = () => {
                setHistory(prev => {
                    const newHistory = [...prev];
                    const prevScene = newHistory.pop();
                    if (prevScene) {
                        setCurrentSceneId(prevScene);
                        localStorage.setItem('oksana_save', prevScene);
                        return newHistory;
                    } else {
                        // –ï—Å–ª–∏ –∏—Å—Ç–æ—Ä–∏–∏ –Ω–µ—Ç, –≤—ã—Ö–æ–¥–∏–º –≤ –º–µ–Ω—é
                        setGameState('menu');
                        return [];
                    }
                });
            };

            const hasSave = !!localStorage.getItem('oksana_save');

            return (
                <div className="h-screen w-screen relative overflow-hidden bg-gray-900">
                    {gameState === 'menu' && (
                        <MainMenu onStart={handleStart} hasSave={hasSave} />
                    )}
                    
                    {gameState === 'game' && STORIES[currentSceneId] && (
                        <Scene 
                            data={STORIES[currentSceneId]} 
                            onChoice={handleChoice} 
                        />
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
